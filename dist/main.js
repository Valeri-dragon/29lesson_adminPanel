(()=>{"use strict";const e=e=>{const t=document.getElementById("table-body");t.innerHTML="",e.forEach((e=>{const{id:n,name:r,email:s,children:o,permission:c}=e;t.insertAdjacentHTML("beforeend",`\n  <tr data-key="${n}">\n                                <th scope="row">${n+1}</th>\n                                <td>${r}</td>\n                                <td>${s}</td>\n                                <td>${o?"Есть":"Нет"}</td>\n                                <td>\n                                    <div class="form-check form-switch">\n                                        <input class="form-check-input" type="checkbox" role="switch"\n                                            id="form-children" ${c?"checked":""}>\n                                    </div>\n                                </td>\n                                <td>\n                                    <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n                                        <button type="button" class="btn btn-warning btn-edit">\n                                            <i class="bi-pencil-square"></i>\n                                        </button>\n                                        <button type="button" class="btn btn-danger btn-remove">\n                                            <i class="bi-person-x"></i>\n                                        </button>\n                                    </div>\n                                </td>\n                            </tr>\n `)}))};window.userService=new class{url="http://localhost:4545/users/";getUsers(){return fetch(this.url).then((e=>e.json()))}addUser(e){return fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()))}removeUser(e){return fetch(this.url+e,{method:"DELETE"}).then((e=>e.json()))}permissionUser(e,t){return fetch(this.url+e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}getUser(e){return fetch(this.url+e).then((e=>e.json()))}editUser(e,t){return fetch(this.url+e,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json()))}filterUsers(e){return fetch(`${this.url}?${e}=true`).then((e=>e.json()))}getSortUsers(e){return fetch(`${this.url}?_sort=${e.name}&_order=${e.value}`).then((e=>e.json()))}getSearchUsers(e){return fetch(`${this.url}?name_like=${e}`).then((e=>e.json()))}},userService.getUsers().then((t=>{e(t)})),(()=>{const t=document.querySelector("form"),n=document.querySelector("#form-name"),r=document.querySelector("#form-email"),s=document.querySelector("#form-children"),o=document.createElement("span");userService.getUsers().then((n=>{e(n),n.forEach((e=>{for(let n in e)r.addEventListener("input",(()=>{e.email===r.value&&(o.textContent="Такой email есть в базе",t.prepend(o),setTimeout((()=>{o.textContent="",r.value=""}),1500))}))}))})),t.addEventListener("submit",(c=>{if(c.preventDefault(),!t.dataset.user)if(""!==n.value&&""!==r.value){const o={name:n.value,email:r.value,children:s.checked,permission:!1};userService.addUser(o).then((()=>{userService.getUsers().then((n=>{e(n),t.reset()}))}))}else o.textContent="Заполните поля",t.prepend(o),setTimeout((()=>{o.textContent=""}),1500)}))})(),document.getElementById("table-body").addEventListener("click",(e=>{if(e.target.closest(".btn-remove")){const t=e.target.closest("tr").dataset.key;userService.removeUser(t).then((()=>{}))}})),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest("input[type=checkbox]")){const n=t.target.closest("tr"),r=n.querySelector("input[type=checkbox]"),s=n.dataset.key;userService.permissionUser(s,{permission:r.checked}).then((t=>{userService.getUsers().then((t=>{e(t)}))}))}})),(()=>{const t=document.getElementById("table-body"),n=document.querySelector("form"),r=document.querySelector("#form-name"),s=document.querySelector("#form-email"),o=document.querySelector("#form-children");let c;t.addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const t=e.target.closest("tr"),i=(t.querySelector("input[type=checkbox]"),t.dataset.key);userService.getUser(i).then((e=>{r.value=e.name,s.value=e.email,o.checked=e.children,c=e.permission,n.dataset.user=i}))}})),n.addEventListener("submit",(t=>{if(t.preventDefault(),n.dataset.user){const i=+t.target.dataset.user;if(""!==r.value&&""!==s.value){const t={name:r.value,email:s.value,children:o.checked,permission:c};console.log(t),userService.editUser(i,t).then((()=>{userService.getUsers().then((t=>{e(t),n.reset(),n.removeAttribute("data-user")}))}))}else{const e=document.createElement("span");e.textContent="Поле не может быть пустым",n.prepend(e),setTimeout((()=>{e.textContent=""}),1500)}}}))})(),(()=>{const t=document.getElementById("btn-isChildren"),n=document.getElementById("btn-isPermissions"),r=document.getElementById("btn-isAll");t.addEventListener("click",(()=>{userService.filterUsers("children").then((t=>{e(t)}))})),n.addEventListener("click",(t=>{userService.filterUsers("permission").then((t=>{e(t)}))})),r.addEventListener("click",(t=>{userService.getUsers().then((t=>{e(t)}))}))})(),(()=>{const t=document.querySelector(".table-dark");let n;t.style.cursor="pointer",t.addEventListener("click",(t=>{t.target.dataset.name&&(console.log(t.target.dataset.name),userService.getSortUsers({name:t.target.dataset.name,value:n?"asc":"desc"}).then((t=>{console.log(t),e(t)}))),n=!n}))})(),(()=>{const t=document.getElementById("search-input"),n=((e,t=1e3)=>(...n)=>{n.lastCall=Date.now();let r=n.lastCall;r&&n.lastCall-r<=t&&clearTimeout(n.lastCallTimer),n.lastCallTimer=setTimeout((()=>e(...n)),t)})((()=>{userService.getSearchUsers(t.value).then((t=>{e(t)}))}),3e3);t.addEventListener("input",n)})()})();